% !TEX root = ./MParticle.tex
\section{Standard Max Pressure Controller: Immediate Feedback} \label{sec:immediatefeedback}

\subsection*{Principle}

Consider a weight assigned to each queue $(l,m)$ as a function of all network queue lengths $X$:
\begin{equation} \label{linkweight}
w(l,m)(X(t))= x(l,m)(t) - \sum_{p \in Out(m)} r(m,p)x(m,p)(t)
\end{equation}
where $Out(m)$ is the set of all links receiving flow from link $m$. The original \emph{immediate feedback} max pressure controller actuates the phase $S^* \in U$ which alleviates the most \emph{pressure} at the intersection. The pressure $\gamma(S)$ that is potentially alleviated by a control action $S$ is defined as follows: 
\begin{align}
\gamma(S)(X(t)) &= \sum_{l,m}c(l,m)w(l,m)(X(t))S(l,m)(t) \\
&= \sum_{l,m: S(l,m)(t) = 1}c(l,m)w(l,m)(X(t))
\end{align}
Explicitly, $u^{*}(X)$ therefore simply choses the phase $S^*\in U$ that maximizes $\gamma(S)(X(t))$ at each time step:
\begin{equation} \label{original_MP}
%\boxed{ 
S^*(t)  = u^{*}(X(t)) = \arg\max\{\gamma(S)(X(t)) \vert S \in U\} 
%}
\end{equation}



\subsection*{First Stability Result}

Varaiya \cite{varaiyaStochastic} has shown that the following stability result holds for the immediate feedback MP controller:
\begin{Thm}\label{StabMP}
The MP control $u^{*}$ is stabilizing whenever the average demand vector $d = \lbrace d_{l}\rbrace$ is within the set of feasible demands
$ D^{0}$.
There is no stabilizing control when $d$ is not within the set of feasible demands $D^{0}$.
\end{Thm}

To prove this theorem, we must demonstrate that the quantity described in \eqref{stability_condition} is bounded when the controller is applied to the system dynamics \eqref{entrydynamics}-\eqref{internaldynamics}. It is however sufficient to show that there exists an $\varepsilon > 0$ such that
\begin{equation} \label{stability_sufficient}
\expectation{ \vert X(t+1)\vert_{2}^2 - \vert X(t)\vert_{2}^2  \big\vert X(t) } < -\varepsilon \vert X(t) \vert_{1} + K
\end{equation}
where $\vert X\vert_{2}^{2} = \sum_{l,m} \vert x(l,m)\vert^{2}$. This is because \eqref{stability_sufficient} immediately implies that 
\begin{equation}
\expectation{\vert X(T+1)\vert_{2}^2} - \expectation{\vert X(1)\vert_{2}^2} < -\varepsilon \sum_{t=1}^{T} \expectation{\vert X(t) \vert_{1}} + KT
\end{equation}
which can be rewritten as a bound on the desired quantity,
\begin{equation} \label{IF_BOUNDS}
\dfrac{\varepsilon}{T} \sum_{t=1}^{T} \expectation{\vert X(t) \vert_{1}}< K + \dfrac{1}{T}\expectation{\vert X(1)\vert_{2}^2}
\end{equation}
<<<<<<< HEAD
The detailed proof of Theorem \ref{StabMP} with an explicit definition of $\varepsilon$ and $K$, as originally derived by Varaiya \cite{varaiyaStochastic},  can be found in Appendix \ref{app_oldproof}. In the following sections we give three extensions of this proof corresponding to the following variations of Max Pressure control:
=======
The detailed proof of Theorem \ref{StabMP} with an explicit definition of $\varepsilon$ and $K$, as originally derived in \cite{varaiyaStochastic}, can be found in Appendix \ref{app_oldproof}. In the following sections we give three original extensions of this proof corresponding to the following variations of Max Pressure control:
>>>>>>> 0fc46f39c275bc663d38511d44f5103ea4caab44
\begin{itemize}
\item \emph{Cycle MP}: Queue states are observed at every time step, but the max pressure controller can only be applied every $\tau$ time steps. 
\item \emph{Distributed MP}: Rather than a single optimal stage, the controller outputs  a convex combination of permissible stages to be applied at every time step.  
\item \emph{Cycle-Distributed MP}: The controller applies a single convex combination of permissible stages for every $\tau$ time steps (a combination of the two above scenarios). 
\end{itemize}



